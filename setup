#!/bin/env sh

# Setup my dotfiles for a fresh Xubuntu installation.
# NOTE: This scripts assumes the dotfiles folder is at path ~/dotfiles

# Makes backup of current dotfiles
echo 'Backing up current dotfiles...'
mkdir ~/dotfilesbak

if [ -f ~/.config/user-dirs.dirs ]; then mv ~/.config/user-dirs.dirs ~/dotfilesbak; fi
if [ -d ~/.config/i3 ]; then mv ~/.config/i3 ~/dotfilesbak; fi
if [ -d ~/.config/i3status ]; then mv ~/.config/i3status ~/dotfilesbak; fi
if [ -f ~/.gitconfig ]; then mv ~/.gitconfig ~/dotfilesbak; fi
if [ -f ~/.bashrc ]; then mv ~/.bashrc ~/dotfilesbak; fi
if [ -f ~/.aliases ]; then mv ~/.aliases ~/dotfilesbak; fi
if [ -d ~/.vim ]; then mv ~/.vim ~/dotfilesbak; fi
if [ -f ~/.vimrc ]; then mv ~/.vimrc ~/dotfilesbak; fi

echo 'All old dotfiles was backed up at ~/dotfilesbak if you wanna those.'

# Install git and download dotfiles from remote repository
# NOTE: ssh must be already configured for GitHub
echo 'Setting up git...'
sudo apt install -y git

echo 'Downloading dotfiles...'
git clone git@github.com:luanrvmood/dotfiles.git
ln -s ~/dotfiles/gitconfig ~/.gitconfig

# Update system default folders (Downloads, Music, Pictures, etc)
echo 'Setting up system folders...'
ln -s ~/dotfiles/dotconfig/user-dirs.dirs ~/.config/user-dirs.dirs
rm -r Desktop Downloads Music Pictures Public Videos Documents Templates
mkdir downloads tracks pics videos docs projects

# Install i3 and i3status
echo 'Setting up i3wm...'
sudo apt install -y i3
echo 'exec i3' > ~/.xinitrc
mkdir ~/.config/i3
mkdir ~/.config/i3status
ln -s ~/dotfiles/dotconfig/i3/config ~/.config/i3/config
ln -s ~/dotfiles/dotconfig/i3status/config ~/.config/i3status/config

echo 'Installing feh for background beauty...'
sudo apt install -y feh

i3-msg reload

# Setup bash and aliases
echo 'Setting up the shell (bash)...'
ln -s ~/dotfiles/shell/aliases ~/.aliases
ln -s ~/dotfiles/shell/bashrc ~/.bashrc

# Installs Vim from source (with os clipboard support) and setup Dracula theme
# NOTE: Need to update /etc/apt/sources.list with additional deb-src URIS
echo 'Setting up Vim...'
sudo apt build-dep -y vim
git clone git@github.com:vim/vim.git

cd vim
./configure --with-x
make
sudo make install
cd
rm -rf vim

ln -s ~/dotfiles/editor/vimrc ~/.vimrc

mkdir -p ~/.vim/pack/themes/start
cd ~/.vim/pack/themes/start
git clone https://github.com/dracula/vim.git dracula
cd

echo 'Setting up Ruby (using RVM)...'
sudo apt install -y gnupg2 curl
gpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
curl -sSL https://get.rvm.io | bash -s stable
source ~/.rvm/scripts/rvm

echo 'Setting up Python...'
sudo apt install -y python3-venv

mkdir -p ~/.vim/after/syntax/
ln -s ~/dotfiles/dotvim/after/syntax/python.vim ~/.vim/after/syntax/python.vim

echo 'Setting up JavaScript...'
mkdir -p ~/.vim/syntax/start/
cd ~/.vim/syntax/start/
git clone git@github.com:pangloss/vim-javascript.git
cd

echo 'Setting up TypeScript...'
mkdir -p ~/.vim/syntax/start/
cd ~/.vim/syntax/start/
git clone git@github.com:leafgarland/typescript-vim.git
cd

echo 'Setting up React/JSX syntax...'
mkdir -p ~/.vim/syntax/start
cd ~/.vim/syntax/start
git clone git@github.com:MaxMEllon/vim-jsx-pretty.git
cd

echo 'Setting up JetBrains Mono font...'
curl -fsSL https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/install_manual.sh | bash -

echo 'DONE!'
